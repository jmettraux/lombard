#!/usr/bin/env ruby

require 'rubygems'
require 'bundler/setup'


$: << 'lib'
require 'lombard'


if ARGV.include?('--version')
  puts "lombard #{Lombard::VERSION}"
  exit 0
end


params = %i[ d data ]

args = {}

loop do
  a = ARGV.shift; break unless a
  m = a.match(/^(-([^-])|--([^-]+))$/); next unless m
  a = (m[3] || m[2]).to_sym
  args[a] = params.include?(a) ? ARGV.shift : true
end

d =
  args[:data] || args[:d]; d = d && "var/#{d}"
dir =
  d && File.directory?(d) ?
  d :
  Dir['var/*'].select { |pa| File.directory?(pa) }.sort.first

l = Lombard.new(dir)

if args[:c] || args[:coins]
  puts l.coins.to_s
  exit 0
end

#p l.categories.keys
#puts
#puts l.to_a(ref: 'wages', cats: %w[ clothes food ])
puts
#puts l.to_table(ref: 'wages', cats: %w[ clothes food ])
puts l.to_table(ref: 'wages')
#puts
#puts l.to_csv(...

#p args

